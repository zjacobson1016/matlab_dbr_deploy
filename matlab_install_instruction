INSTALL STEPS:
If installing on Mac (If you have a mac install parallels software for Windows install. Then follow the same instructions below): Go to step 5 once this entire step is complete
 (see figure 1 below).This is the login to your Mathworks account. Navigate to your trial or license, click on the downward arrow to download Mathworks product.
*After downloading below follow the instructions linked below to install and unzip matlab appropriately: https://www.mathworks.com/matlabcentral/answers/1606600-matlab-using-parallels-on-m1-macbook-pro
YOU HAVE TO DO THIS OTHERWISE MATLAB WON‚ÄôT DOWNLOAD üò†
Download MATLAB for Windows
Unzip the downloaded file, taking note of the temp folder the files are to be unzipped into (mine was "_temp_matlab_R2022a_win64")
Go into the temp folder, then the bin folder, then win64 folder. Once here, find MathWorksProductInstaller and double click. (My directory was: \Downloads\_temp_matlab_R2022a_win64\bin\win64\MathWorksProductInstaller)
You should be able to continue with the normal installation from here.
If installing on Linux: (Go to step 8 once this entire step is complete)
Launch EC2 instance
Install ubuntu
Configure port for open traffic
Generate .pem file for ssh
Ssh into ec2 instance
zach.jacobson@L44CFYWMW4 downloads % chmod 600 matlab_zj.pem
zach.jacobson@L44CFYWMW4 downloads % ssh -i matlab_zj.pem ubuntu@54.67.118.95
For remote access to use ubuntu ui: https://shrihariharidas73.medium.com/how-to-setup-gui-desktop-with-ubuntu-on-aws-ec2-ea713d836a58 (follow these steps
Remote into ec2 instance with remote desktop client
Download matlab run time from  for linux on ec2 instance. (see figure 1 below).This is the login to your Mathworks account. Navigate to your trial or license.
Navigate to the zip folder and unzip to location of your choosing. 
Navigate to the install file and right click and ‚Äúlaunch as program‚Äù . Walk through all the steps
Then go back to the unzipped folder and right click on the matlab file and launch as program
Once download is complete, then go to this link: https://www.mathworks.com/solutions/partners/databricks.html# and scroll down to the bottom and click the ‚ÄúDownload the MATLAB Interface for Databricks‚Äù button. 











	(FIGURE 1)



Once download is complete, then go to this link: https://www.mathworks.com/solutions/partners/databricks.html# and scroll down to the bottom and click the ‚ÄúDownload the MATLAB Interface for Databricks‚Äù button.
Extract the compressed zipped folder ‚Äúmatlab-databricks-v4-0-7-build-...‚Äù inside Program Files\ MATLAB. Once extracted you will see the ‚Äúmatlab-databricks‚Äù folder. Make sure the folders are in this folder and this hierarchy:


Launch the Matlab application from local Desktop application through Search bar and make sure to run as an administrator for overwrite of files and folders
Go to the command line interface in matlab and type ‚Äúver‚Äù to verify you have all the dependencies necessary:


Next you are ready to install the run time on databricks cluster:
Navigate to this path: C:\Program Files\MATLAB\matlab-databricks\Software\MATLAB: cd ‚ÄòC:\Program Files\MATLAB\matlab-databricks\Software\MATLAB‚Äô (You should see in the top bar next to the folders icon the current directory path. Make sure that path looks like the path written above.
Type ‚Äúinstall(download="14.3")‚Äù 
You will be prompted with several questions for configuring the cluster spin up. Please reference my video here: TBD @time to see how I retrieved all the info from databricks
Enter authentication method, other methods can be configured manually following installation
Choose one of: Chain, DotDatabricksConnect, PAT, Basic, OauthM2M or OauthU2M, [PAT]: 


You will see your cluster appear in databricks 
Next you will receive this question: Enter the local path to the downloaded zip file for this package (Point to the one on your local machine
E.g.: C:\Users\someuser\Downloads\matlab-databricks-v1.2.3_Build_A1234567.zip
A job will be created in Databricks automatically as shown below (Make sure the job timeout is set to 30 minutes or greater to avoid timeout error)

Go to Workspace->Mathworks->4.0.7->runtime. Click on three dots and click ‚ÄúCopy URL/path and copy the full path
Go to
You now have a Databricks cluster with Matlab runtime installed. So now every time you launch it there is nothing you need to do. The cluster should have spark env variables and init script pointing to the shell file that was generated from the job
TBD‚Ä¶. Calling Matlab functions in Databricks


There is currently no valid Databricks Connect library on the static classpath
The following Databricks Connect libraries are available:
  1: /home/ubuntu/Desktop/matlab-databricks-v4-0-7-build-3e4140c2/matlab-databricks/Software/MATLAB/lib/jar/matlab-databricks-connectv2-14.3.3.jar

Select the number of the library to use or just Enter to skip updating the Java classpath: 1
Overwrite, Append (default) or Skip to make a manual change later O/[A]/S: A
edit(fullfile(prefdir,‚Äôjavaclasspath.txt‚Äô)) 
I had to do this to create the javaclasspath because I terminated early. The path that will be pasted in this file created is the /Software/MATLAB/lib/jar/matlab-databricks-connectv2-14.3.3.jar
Run the ‚ÄúStartup‚Äù command in CLI
Cl = createDatabricksCluster(‚Äòzach‚Äô,0 ‚Äì nodes) 
Could not create cluster in west workspace due to permission
Manually going to attach the env variables and init script
Make sure the cluster created does not have the ML runt time. Patch next week
Env Variables:
LD_LIBRARY_PATH=/usr/local/MATLAB/MATLAB_Runtime/R2024a/runtime/glnxa64:/usr/local/MATLAB/MATLAB_Runtime/R2024a/bin/glnxa64:/usr/local/MATLAB/MATLAB_Runtime/R2024a/sys/os/glnxa64:/usr/local/MATLAB/MATLAB_Runtime/R2024a/extern/bin/glnxa64:/usr/local/MATLAB/MATLAB_Runtime/R2024a/sys/opengl/lib/glnxa64 MW_CONNECTOR_CONNECTION_PROFILES=noop PYSPARK_PYTHON=/databricks/python3/bin/python3
INIT SCRIPT
/Users/zach.jacobson@databricks.com/MathWorks/4.0.7/runtime/runtime_install_r2024a.sh (had to replace the file path with a different version. Was a bug when running the cluster you may see this error)
Open notebook and Move files from dbfs to volumes:  dbutils.fs.cp("dbfs:/MathWorks", "/Volumes/main/zach_jacobson/mathworks", recurse=True). This is because Databricks‚Äô policy wipes the zip file in dbfs zip file. (This path can be found when you click on runtime_install_r2024a.sh)
Example: RUNTIME_ZIP="/dbfs/MathWorks/runtime/MATLAB_Runtime_R2024a_Update_1_glnxa64.zip"


Verify workspace is correct: ws = databricks.Workspace
ws.ls
PSB = build_python (builds wheel file) (ref here: https://github.com/mathworks-ref-arch/matlab-spark-api/blob/main/Documentation/PythonSparkBuilder.md) 
Make sure you have pip3 installed. Use this command in CLI: !sudo apt install python3-pip
*Patch coming next week with ML library on compute cluster.  
Upload wheel file to databrick workspace: PSB.uploadWheelToDatabricks(‚Äú/dbfs/MathWorks‚Äù,‚Äùcluster_id‚Äù) ‚Äì Use volumes path above after uploaded to dbfs. Use same command:  dbutils.fs.cp("dbfs:/MathWorks", "/Volumes/main/zach_jacobson/mathworks", recurse=True)
Notebook:
from demo.nyc.wrapper import nycAlgo
T = nycAlgo
Steps for simulink model. Upload wheel to dbfs/volumes
Make sure matlab-databricks is not in matlab run time 
Run the .prj file to set up all the variables
Run the .slx file and do control + d to refresh the model
Run the build_python_function.m to build the wheel



